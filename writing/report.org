#+Title: III: Metrics and radar plots
#+author: Nick Merrill
#+options: toc:nil

# * "Layer models" of the Internet


I've collected metrics for all of 2019, for all of the data sources in our
dataset. There may be an issue with our layer 3 (internet interference) data,
but as we diagnose, I thought it would be a fair time to introduce the
particulars of the metrics and share some preliminary radar charts (with the
caveat that data may change).

We may be all on the same page with metrics, but often, the devil is in the
details. It's worth going through each layer's metrics and discussing their
particulars.
* Layers of the stack
[2019-10-30 Wed]
** Background
"Layer models" describe the Internet's composition using hierarchical concepts,
each defined by their function. Each layer sits "ontop" of the layer beneath it.
Lower-levels are more basic, and appear at the "bottom" of the stack, whereas
the more abstracted layers appear at the "top" of the stack.

There are two main "Layer" models for the Internet: the TCP/IP model and the OSI
model. Both provide some opportunities and challenges for us.

** TCP/IP (networking) 5-layer model

| Layer              | Number  | Example metric              |
|--------------------+---------+-----------------------------|
| Legal/social/human | Layer 5 | Data locality laws          |
| Application        | Layer 4 | Website ranking locality    |
| Transport          | Layer 3 | Network interference events |
| Network            | Layer 2 | IPv4/IPv6 transition        |
| Link               | Layer 1 |                             |

The TCP/IP networking model of the Internet specifically, as opposed to a model
of a generic network. The TCP/IP model is used in any intro networking courses
(including MICS W210 - I checked). The question the TCP/IP model answers is, "In
practice, how is the Internet split into functionally different layers?"

*** TCP/IP model layer definitions

- "Layer 5" (legal/social/human). Above the application layer, the "fifth layer"
  refers to anything regarding human activity. Data locality laws exist "above"
  the application layer. This layer is not formally included in the model;
  rather, it's discussed colloquially.
- Application layer. Standardizes communications across transport layer to
  create specific-purpose functionality. Web browsing (HTTP/HTTPS) is a familiar
  example of application-layer software.
- Transport layer. Abstract network and link layers to provide appearance of
  persistent connections. Network interference connections disrupt this layer. [fn:1] 
- Network layer. Transfers data between networks. The IP protocols (either v4 or
  v6) manage this transfer.
- Link layer. Transfers data within a local network.

** OSI model

| Layer                             | Number | Example metric              |
|-----------------------------------+--------+-----------------------------|
| Individual/organization/political |     8+ | Data locality laws          |
| Application                       |      7 | Website ranking locality    |
| Presentation                      |      6 |                             |
| Session                           |      5 | Network interference events |
| Transport                         |      4 |                             |
| Network                           |      3 | IPv4/IPv6                   |
| Link                              |      2 |                             |
| Physical                          |      1 |                             |

The OSI networking model seeks to describe general telecommunications platforms,
and is not specific to the Internet. It is an ISO standard (ISO/IEC 7498), and
was initially developed to allow interoperability (hah!) between disparate
network devices and software.

The OSI model introduces a few new layers, and redefines some familiar ones. The
main differences from the TCP/IP model are (1) the introduction of the physical layer,
(2) the split between "application" and "presentation" layers, and (3) the split
between the "session" and "transport" layers.

*** OSI model layer definitions

- "Layer 8 and above." Again, though not included in the formal model, "layer 8"
  colloquially refers to the "user" or "political" layer that "runs ontop of"
  the OSI stack. Bruce Schneier further divides this layer into layers 8 (the
  individual), 9 (the organization) and 10 (legal/political). However, the term
  "layer 8" appears to be more common in colloquial usage.
- Application layer. (No change).
- Presentation layer. Translation of data between a networking service and an
  application. Examples include UNICODE, which translates bytes to visual
  glyphs.
- Session layer. Abstract transport layer to provide appearance of persistent connections.
- Transport layer. Reliable transmission of data segments between points on a network (e.g., segmentation, acknowledgment and multiplexing
- Network layer. (No change).
- Link layer. (No change).
- Physical layer. The physical devices that emit, transmit, and receive data. Examples include ethernet cables, network chips, or the radio transmitters that emit WiFi or Bluetooth.

** Recommendations and reflections

*** Pros & cons of using the TCP/IP model

Pros:
- Anyone who knows the OSI model will also know the TCP/IP model terms
- We have roughly one metric per layer already
- We are able to move to the OSI model later as we get more metrics and more detail.

Cons:
- Fewer layers, less subtly to the division between layers. Could limit growth.
- Some people may ask why we didn't use the OSI model. One explanation might be
  that we were focused on the Internet specifically, whereas OSI is a generic
  model of telecom networks. 

*** Pros & cons of using the OSI model

Pros:
- "Layer 8" appears to be a more common way of referring to the "human layer"
  than "layer 5." It also gives us some more subtlety up here [[https://web.archive.org/web/20130524214239/http://blogs.rsa.com/engineering-security-solutions-at-layer-8-and-above/][due to Bruce
  Schneier]]: we can further expand into the "individual," "organization" and
  "government or legal" layers 8-10 in the future.
- When network professionals describe attacks, they will typically refer to the
  OSI model layers. For example, DHCP spoofing is a "layer-2 attack," even
  though DHCP is Layer 1 of the TCP/IP model.
- It's an ISO standard, originally designed for interoperability, which may be a
  core theoretical construct for our project.

Cons:
- *Lots* of layers, *lots* of terminology to introduce.
- We do not have a metric for many layers.
- Since the OSI model is not as Internet-specific as TCP/IP

*** My recommendation

I vote that we begin with the TCP/IP layer model. It makes for an easier story
in the context of a quick pitch, minimizing confusing terms to introduce, and
maximizing the ostensible conceptual coverage of our metrics.

In the Medium post, we can always make a quick mention that we'll consider
moving to the OSI model as we add more metrics. 

Alternatively, we can always integrate new layers (e.g., the physical layer)
into our TCP/IP model to produce a reasonable, purpose-built hybrid.

*** Reflections

**** Choosing layers of the stack

It *almost* goes without saying, but none of these metrics fit neatly and
perfectly into exactly one layer of the network. We always knew that would be
the case. Even the seemingly-straightforward "IPv4/IPv6 transition" metric is
entangled with all other layers of the stack: What do link layers support? What
do transport layers allow? What do applications require? What legal mechanisms
incentivize the transition?

Nevertheless, within a finite set of options, each metric has a clear "home" in
any given model. Once we pick a model, we can provide a clear rationale for this
"home" next to the description of the layer. (A proper web dashboard would make
these explanations easy to explore, too).

One heuristic for solving these conundrums is to ask, "What is the highest level
of the stack this phenomenon affects?" For example, network interference events
happen at both the transport and session layers of the OSI stack. [fn:2]
However, network interference events happen only as high as the session layer
(they break or disrupt user connections with services).

**** Future questions

Looking at the OSI model, I'm realizing some questions we could ask in the future. 
- Does everyone use UNICODE (presentation layer)? 
- What proportion of the Internet uses TCP, UDP, QUC (transport layer of OSI model)?

It also reminds me of a question we've asked in the past:
- When do physical layer differences matter? How can we measure these differences?

These questions are out of scope for this sprint, but I do believe that they matter.


Archived entries from file /home/ffff/Programs/III/writing/report.org

* Methods and metrics
[2019-11-06 Wed]
** One metric per layer
*** Layer 2: IPv6 adoption

As a proxy for interlink layer (layer 2) fragmentation, we use [[https://www.google.com/intl/en/ipv6/statistics.html#tab=per-country-ipv6-adoption][Google's
per-country IPv6 adoption statistics]], which Google collects from all Google
services and analytics users. I suspected that they would radically
under-estimate adoption in China, where Google is blocked, but surprisingly,
Google's statistic [[http://www.xinhuanet.com/english/2019-03/14/c_137895292.htm][roughly matches the one given by state-run Chinese media]].

*** Layer 3: Network interference events

To measure transport layer (layer 3) fragmentation, we use data collected by the
[[https://ooni.org/][Open Observatory of Network Interference]] (OONI). OONI requires volunteers to
install a plugin, which periodically performs tests to measure circumvention on
the transport layer. These include mostly state-launched attacks (such as DNS
manipulation or traffic filtering), but may also include private-sector
manipulation, such as throttling streaming traffic.

Since different countries produce radically different numbers of reports per
year, we compute a "rate" of anomalous observations per all reports generated.

*** Layer 4: Website ranking locality

We use the [[https://www.alexa.com/topsites][Alexa rankings]] to determine the 50 most popular websites in every
country (by traffic). We then compare each country's most popular websites to
the worldwide most popular websites, using [[https://en.wikipedia.org/wiki/Levenshtein_distance][Levenshtein distance]] to compute the
edit distance between the two lists. This leaves us with a metric expressing how
much each country's web browsing habits differs from the global rankings. [fn:5] 


*** Layer 5: Data locality laws

Right now, I count one type of data locality law: whether a given country
restricts the cross-border flow of data (any type). We code this as a binary
variable. 

One clear issue with this metric: it's binary, which removes some subtlety from
the radar chart. I have brainstormed different ways to make this metric a bit
more (numerically) nuanced in the future (see [[layer5-variation]]).

** Visualizing the metrics: Radar charts

How do we visualize these metrics? Right now, our strategy is to produce a
"radar" (or "spiderweb") plot. The radar plot describes a given country's spread
across the four metrics we currently measure. By visually comparing these radar
plots, we can establish rough "profiles" for countries. [fn:3]


[[./figures/us-uk-nz.png]]

Here's an example. It compares the US, UK and New Zealand. This radar chart
shows us that the UK and New Zealand are similar, but the United States shows
more fragmentation on layers 2 and 3. However, all three countries have no
restrictions on cross-border data flow, and they all have about the same amount
of network interference. *NOTE*: /Data may change slightly here as we sanity
check our preprocessing---layer 3 data in particularespecially /.


[[./figures/belt-and-road.png]]

We can also average multiple countries' metrics together to create /blocks/.
Here's an example comparing Five Eyes countries with Belt and Road countries.
Overall, Belt & Road countries have higher website locality (perhaps as a result
of censorship), higher rates of network interference, and very low adoption of
IPv6. (They have slightly higher rates of having cross-border data transfer laws,
but it's not clear yet whether the difference is significant).

** Reflections

*** Introducing variation into Layer 5
<<layer5-variation>>

This binary variable doesn't give us enough variation. As much as I'm loathe to
"generate quantification," one possibility is to bucket data-related laws by
domain (cross-border data flows, privacy, data sovereignty), code them as binaries
per category, and sum them. This will produce an aggregate score in which all
data-related laws are equally weighted. What do folks think about this approach?
See Appendix [[data-laws-type]] for the types of data laws we coded over the summer.


Cons:
- This may get us in trouble with sticklers, who will argue that not all data
  laws are equally consequential.

Pros:
- It will certainly introduce variation into our metric, and hopefully will
  produce a normal (rather than bimodal) distribution among countries.

*** Dealing with the European Union

For our layer 5 metric, the European Union (GDPR) is tricky here. GDPR does
restrict certain types of cross-border data flows. For now, I've counted all EU
member states as "yes," as the GDPR laws apply there. However, this law
restricts data flows /out of the EU/, not (e.g.) between Belgium and
Netherlands. So having each country ``inherit'' the EU law may be misleading.

In the future, we may want to include EU *and* member states as separate, if
geographically overlapping entities for our analysis. Any thoughts on this would
be much appreciated.

*** Layer 5: Are laws enforced?

Are the laws described in Layer 5 enforced? Our metric does not currently
capture this question. It could, but may require some bespoke input from people
"on the ground," which we are trying to avoid right now. I'm inclined to ignore
this for now, and add it to the ``think about later'' pile (a pile I am, for the
record, diligently collecting).

* Findings and discussion
** Countries I expected to be similar are more different than I expected

*** The Scandinavians

*** Five eyes

**** Five eyes vs G7

** Nevertheless, averaged "blocks" still reveal diferences

*** Belt & road
*** Islamic theocracies

** 'Best buddies' reveal interesting regional affinities---and differences

** TODO Reflections

*** Major findings

The internet is *not* bi-polar. There are serious and meaningful differences
between countries, but you cannot easily place these differences on a pole of
"more to less" fragmented.

Without our metric, it would be tempting to place Bahrain along with China
on one side of the "censored Internet" spectrum, and the US along with Denmark
on the "free Internet" side. Our metrics reveal a much more complex picture.
Sweden has as much network interference. In fact, all four countries mentioned
here are much different from one another.

Even within similar blocks, there are important differences to tease out: IPv6
adoption, content layer differences, and network interference all vary within
otherwise "similar" countries, revealing unexpected differences (e.g., among the
Scandinavians).

In spite of these surprises, our metrics allow "profiles" of similar to emerge
naturally. Five eyes, Belt and Road, and even regions such as the Caribbean all
show characteristic patterns, and all are unique.

*** Am I convinced?

Currently, it's a little difficult to interpret these data outside of their
specific meeting. For example, to me, IPv6 is a more immediate proxy of a
country's "development" (another ambiguous term) than it is a proxy of
"fragmentation."

Of all of the metrics, website locality convinces me the most. It's a measure of
actual user behavior. I am sure network interference matters (and may matter
more if we split it down by interference type), but ultimately, the experience
of e.g., censorship may more acutely felt in the context of website locality (as
is the case with China).

In general, behavioral measures may appear more at the content layer. I'm not
sure that's a bad thing. The content layer shows us what people are, in
practice, doing. Yes, maybe laws that restrict data flows matter, but can we
observe that with actual behavior?

*** TODO What's in a name?
Really either interoperability *or* an index right now
more like internet character profiles

we also assume that index is going to be the one thing that sells
maybe, maybe not... maybe these indices are also appropriate.
** TODO Future work
*** Expanding metrics per layer

In layer 4, we may be interested in DNS consistency as one measure of
Internet-level fragmentation. DNS consistency has a clear relationship to the
experience of browsing the Internet: what websites *can* you visit? It would be
worth researching possible sources for this data.

In general, in the future, it's worth thinking about how we would deal with
multiple metrics per layer. They don't fit neatly into our radar graph any more,
and we may have to do some averaging per-layer to compute a composite metric.
There's some art to this, I figure, and we should be mindful of that as we
expand horizontally within TCP/IP layers.
*** UI wishlist

It would also be great to view metrics in greater detail on rollover. We
certainly want our APIs to support that.

* Appendix

** Data laws by type
<<data-laws-type>>

- Online sales
- Domain name (DNS) registration requirements
- Export restrictions
- Bandwidth, net neutrality
- Lack of safe harbor for intermediary liability
- Sanctions for non-compliance
- Administrative requirements on data privacy
- Data retention
- Restrictions on cross-border data flows
- Other restrictive practices related to business mobility
- Quotas, Labour Market Tests, Limits of Stay
- Other restrictive practices related to competition policy
- Competition
- Copyright
- Patents
- Screening of investment and acquisitions
- Restrictions on ownership
- Technology mandate
- Preferential purchase schemes covering digital products and services
- Discriminatory tax regime on online services
- Discriminatory tax regime on digital goods and products
- Antidumping, CVD &amp; Safeguards
- Applied tariffs on digital goods
- Barriers to fulfillment
- Product screening and testing requirements
- Product safety certification (EMC/EMI, radio transmission)
- Import restrictions
- Censorship and filtering of web content
- Notice and takedown requirement
- Other
- Personal rights to data privacy
- Trade secrets
- Other restrictive practices related to foreign investment
- Restrictions on board of directors and managers
- Taxation on data usage
- Other restrictive practices related to IPR
- Telecom network and base standards
- Local Content Requeriments for commercial market
- Requirement to surrender patents, source codes, trade secrets
- Subsidies and favourable tax regime
- Other restrictive practices related to content access
- Encryption
- Other restrictive practices related to standards
- Discriminatory / disproportionate consumer protection
- Other restrictive practices related to intermediary liability
* Footnotes

[fn:5] To pump the intuition here... At the bottom of these rankings (most
country-specific), we have China; at the top (most similar to the global
rankings), we have Luxembourg.

[fn:4] We can debate this one another time. 

[fn:3] For ease of display in a radar plot, we transform all data to be between
0 and 1, and assure all continuous variables are roughly normally distributed.
Setting aside our binary variable (layer 5), both Layer 2 and Layer 4's metrics

are (rougly) normally distributed. Layer 3's metric, on the other hand, is
roughly a power law distribution (i.e., a few countries have 10-100x the rate of
network inteference as the majority). We "view" these data on a logarithmic
scale in the radar plot, (I confirmed that the log-scale data are roughly
normal).

[fn:2] Sometimes they occur as low as level 2, as in BPG poisoning, but that's rare.

[fn:1] Network and link layers work by message-passing; there is no notion of a
"connection" in these layers."
